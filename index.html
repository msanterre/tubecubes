<!DOCTYPE html>
<html>

<body>
</body>
<script src="three.js/build/Three.js"></script>
<script>
  PLANE_SIZE = 400

  var lvl_array = [  ['o','o','o','o'],
                     ['o','o','o','o'],
                     ['o','o','o','o'],
                     ['o','o','o','o']
                  ];
</script>

<script>
  var camera, scene, renderer, controls, clock, plane;
  
  init();
  animate();
  
  function init(){
    clock = new THREE.Clock();
    scene = new THREE.Scene();
    
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.z = 1000;
    scene.add(camera);
    
    controls = new THREE.FirstPersonControls( camera );
  
    controls.movementSpeed = 1000;
    controls.lookSpeed = 0.125;
    controls.lookVertical = true;
    controls.constrainVertical = true;
    controls.verticalMin = 1.1;
    controls.verticalMax = 2.2;
    controls.noFly = true;
    
    planes = []
    
    var level = loadLevel(lvl_array);
    
    //Ceiling
    for(var i = 0; i < 10; i++){
      plane = getSquarePlane(PLANE_SIZE);
      plane.position = new THREE.Vector3(i * PLANE_SIZE, PLANE_SIZE / 2, PLANE_SIZE / 2);
      plane.rotation.x = 90 * (Math.PI / 180);
      scene.add(plane);
    }
    //Back
    for(var i = 0; i < 10; i++){
      plane = getSquarePlane(PLANE_SIZE);
      plane.position = new THREE.Vector3(i * PLANE_SIZE, 0, 0);
      scene.add(plane);
    }
    //Floor
    for(var i = 0; i < 10; i++){
      plane = getSquarePlane(PLANE_SIZE);
      plane.position = new THREE.Vector3(i * PLANE_SIZE, 0, PLANE_SIZE);
      plane.rotation.y = -180 * (Math.PI / 180);
      scene.add(plane);
    }
    //Front
    for(var i = 0; i < 10; i++){
      plane = getSquarePlane(PLANE_SIZE);
      plane.position = new THREE.Vector3(i * PLANE_SIZE, -PLANE_SIZE/2, PLANE_SIZE/2);
      plane.rotation.x = -90 * (Math.PI / 180);
      scene.add(plane);
    }
    
    renderer = new THREE.CanvasRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
  }
  
  function loadLevel(level_array){
    var walls = [];
    
    if(verifyLevel(level_array)){
      lvlLen = level_array[0].length;
      lvlHgt = level_array.length;
      
      for(var x = 0; x < lvlLen; x++){
        for(var y = 0; y < lvlHgt; y++){
          
          //Cases where the left wall exists
          if((x == 0 && level_array[y][x] == 'o') ||
             (x > 0 && level_array[y][x] == 'o' && level_array[y][x-1] == 'x')){
             plane = getSquarePlane(PLANE_SIZE);
             plane.position = new THREE.Vector3(x * PLANE_SIZE, 0, 0);
             walls.push(plane);
             }
          //Cases where the top wall exists
          if((y == 0 && level_array[y][x] == 'o') ||
             (y > 0 && level_array[y][x] == 'o' && level_array[y-1][x] == 'x')){
              plane = getSquarePlane(PLANE_SIZE);
              plane.position = new THREE.Vector3(x * PLANE_SIZE, 0, 0);
              walls.push(plane);
             }
          //Cases where the right wall exists
          if((x == lvlLen - 1 && level_array[y][x] == 'o') || 
              (x < lvlLen - 1 && level_array[y][x] == 'o' && level_array[y][x+1] == 'x')){
               plane = getSquarePlane(PLANE_SIZE);
               plane.position = new THREE.Vector3(x * PLANE_SIZE, 0, 0);
               walls.push(plane);
              }
          //Cases where the bottom wall exists
          if((y == lvlHgt - 1 && level_array[y][x] == 'o') || 
            (y < lvlHgt - 1 && level_array[y][x] == 'o' && level_array[y+1][x] == 'x')){
             plane = getSquarePlane(PLANE_SIZE);
             plane.position = new THREE.Vector3(x * PLANE_SIZE, 0, 0);
             walls.push(plane);
            }
          //Create the ceiling and floor
          if(level_array[y][x] == 'o'){
            
            //Ceiling
            plane = getSquarePlane(PLANE_SIZE);
            plane.position = new THREE.Vector3(x * PLANE_SIZE, 0, 0);
            plane.rotation.y = 180 * (Math.PI / 180);
            walls.push(plane);
            
            //Floor
            plane = getSquarePlane(PLANE_SIZE);
            plane.position = new THREE.Vector3(x * PLANE_SIZE, 0, 0);
            plane.rotation.y = -180 * (Math.PI / 180);
            walls.push(plane);
          }
        }
      }
    }
    else{ 
      alert("Level of wrong dimensions."); 
    }
    return walls;
  }
  
  function getSquarePlane(plane_size){
    plane = new THREE.Mesh(
                                 new THREE.PlaneGeometry( plane_size, plane_size ), 
                                 new THREE.MeshBasicMaterial( { color: 0x000 } )
                           );
    return plane;
  }
  function verifyLevel(level_array){
    if(level_array.length > 0){
      length = level_array[0].length;
      for(var i; i < level_array.length; i++){
        if(level_array[i].length != length)
          return false;
      }
    }
    else{
      return false;
    }
    return true;
  }
  function animate(){
    requestAnimationFrame(animate);
    render();
  }
  
  function render(){
    controls.update(clock.getDelta());
    renderer.render(scene, camera);
  }
</script>
</html>
